<!--
    References:
    
	1. https://www.codementor.io/@azeezolaniran2016/a-simple-calculator-app-using-react-and-node-a0ubeooxk

	2. https://socket.io/
 -->
<!DOCTYPE html>
<html lang="en">
	<head>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<style>
			
			.calculator {
				width: 600px;
				border: 1px solid black;
				display: grid;
				grid-template-columns: 1fr 1fr 1fr 1fr;
				grid-template-rows: repeat(6, 70px);
				grid-gap: 4px;
			}

			.display {
				grid-column: 1 / -1;
				width: 100%;
				margin: 0px;
				display: flex;
				justify-content: flex-end;
				flex-direction: column;
				height: 100%;
			}
			.display > div {
				width: 100%;
				text-align: right;
			}

			.display #top-display {
				height: 100%;
				height: 40%;
				font-size: 2rem;
			}
			.display #bottom-display {
				
				height: 80%;

				font-size: 1.6rem;
				line-height: 50px;
				font-weight: 600;
			}

			section button {
				border: none;
				font-size: 1.3rem;
				outline: none;
			}
			section button:hover {
				transition-duration: 0.8s;
			}

			#zero,
			#all-clear {
				grid-column: span 2;
			}

			#results {
				
				font-size: 1.2rem;
				font-weight: lighter;
				
			}

			.result-card {
				font-size: 2rem;
				width: 300px;
				padding: 3px;
				margin-bottom: 15px;
			}
		</style>
		
	</head>
	<body>
		<main>
			<section class="calculator">
				<section class="display">
					<div id="top-display"></div>
					<div id="bottom-display"></div>
				</section>

				<button data-clear="clear" id="all-clear">AC</button>
				<button data-int-sign="int-sign">+/-</button>
				<button data-operand="operand">รท</button>
				<button data-integer="integer">7</button>
				<button data-integer="integer">8</button>
				<button data-integer="integer">9</button>
				<button data-operand="operand">*</button>
				<button data-integer="integer">4</button>
				<button data-integer="integer">5</button>
				<button data-integer="integer">6</button>
				<button data-operand="operand">-</button>
				<button data-integer="integer">1</button>
				<button data-integer="integer">2</button>
				<button data-integer="integer">3</button>
				<button data-operand="operand">+</button>
				<button data-integer="integer" id="zero">0</button>
				<button data-integer="integer">.</button>
				<button data-equals="equal">=</button>
			</section>
			<section id="results"></section>
		</main>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			// Load the socket Client
			let socket = io();

			// Query Selectors for elements on the html file
			const allNumbers = document.querySelectorAll("[data-integer]");
			const operands = document.querySelectorAll("[data-operand]");
			const clearAll = document.querySelector("[data-clear]");
			const equal = document.querySelector("[data-equals]");
			const integerSign = document.querySelectorAll("[data-int-sign]");
			const percent = document.querySelector("[data-percent]");
			const intSign = document.querySelector("[data-int-sign]");

			// Calculator class
			class Calculator {
				constructor() {
					this.firstInt = null;
					this.secondInt = null;
					this.total = null;
					this.topDisplay = document.getElementById("top-display");
					this.bottomDisplay = document.getElementById("bottom-display");
					this.operationSign = "";

					// Open a socket connection when ever this class in initialize.
					socket.on("calculate", function ({ displayText }) {
						
						if (typeof displayText === "string") {
							const result = document.createElement("div");
							result.className = "result-card";
							result.innerText = displayText;


							if (document.getElementById("results").childElementCount === 9) {
								const lastChild = document.getElementById("results").lastChild;
								document.getElementById("results").removeChild(lastChild);
							}

							document.getElementById("results").prepend(result);
						}
					});
				}

				// Clears top display field
				clearTop() {
					this.topDisplay.innerText = "";
				}

				// Clears bottom display field
				clearBottom() {
					this.bottomDisplay.innerText = "";
				}

				// Clears top and bottom display field
				clearAll() {
					this.clearTop();
					this.clearBottom();
				}

				// Assign and remove negative signs from numbers being typed in
				posNeg() {
					if (this.bottomDisplay.innerText) {
						if (this.bottomDisplay.innerText[0] === "-") {
							this.bottomDisplay.innerText = this.bottomDisplay.innerText.slice(1);
						} else {
							this.bottomDisplay.innerText = "- " + this.bottomDisplay.innerText;
						}
					}
				}

				// Updates the bottom display field when someone clicks a number
				updateButtonDisplay(number) {
					if (this.total) {
						this.total = null;
						this.bottomDisplay.innerText = String(number);
					} else {
						
						if (this.bottomDisplay.innerText.includes(".") && number === ".") return;
						this.bottomDisplay.innerText += String(number);
					}
				}

				
				setOperand(sign) {
					this.firstInt = this.bottomDisplay.innerText;
					this.operationSign = sign === "รท" ? "/" : sign;

					this.clearBottom();
					if (!!this.firstInt || this.firstInt === 0) {
						this.topDisplay.innerText += `${this.firstInt} ${sign}`;
					}
				}

				compute() {
					this.secondInt = this.bottomDisplay.innerText;

					if (!this.firstInt && !this.secondInt) return; 
					this.firstInt = Number(
						(!!this.firstInt || this.firstInt === 0) &&
							this.removeSpaceFromInt(this.firstInt)
					);
					this.secondInt = Number(
						(!!this.secondInt || this.secondInt === 0) &&
							this.removeSpaceFromInt(this.secondInt)
					);

					this.total = eval(`${this.firstInt} ${this.operationSign} ${this.secondInt}`);
					this.total = Number(this.total.toFixed(6));
					let displayText = `${this.firstInt} ${this.operationSign} ${this.secondInt} = ${this.total}`;

					this.clearAll();

					
					if (this.total === Infinity) {
						this.bottomDisplay.innerText = "Error";
						displayText = "Error";
						this.clearAll();
					} else {
						this.bottomDisplay.innerText = this.total;
					}

					socket.emit("calculate", { displayText, lastTen: this.lastTen });
					this.firstInt = null;
					this.secondInt = null;
				}

			
				removeSpaceFromInt(number) {
					return number.split(" ").join("");
				}
				computePercent() {}
			}

			// Initialize calculator
			const calculator = new Calculator();

			
			clearAll.addEventListener("click", () => {
				calculator.clearAll();
			});

			//numbers
			allNumbers.forEach((number) => {
				number.addEventListener("click", (event) => {
					calculator.updateButtonDisplay(event.target.innerText);
				});
			});

			//operands
			operands.forEach((operand) => {
				operand.addEventListener("click", (event) => {
					calculator.setOperand(event.target.innerText);
				});
			});

			equal.addEventListener("click", () => {
				calculator.compute();
			});

		
			intSign.addEventListener("click", () => {
				calculator.posNeg();
			});
		</script>
	</body>
</html>
